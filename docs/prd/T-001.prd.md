# T-001: MVP — Запись на игры и формирование состава

**Status:** DRAFT

## Контекст

Любительские хоккейные команды испытывают сложности с организацией игр и тренировок:
- Сложно понять, кто придёт на игру
- Тренер тратит время на сбор подтверждений в чатах
- Нет единого места для просмотра расписания и состава

Telegram Mini App решает эти проблемы, интегрируясь в привычный мессенджер команды.

## Цели

1. Игроки могут быстро записаться/отписаться от события
2. Тренер видит актуальный список записавшихся
3. Тренер может сформировать состав (основа/запас)
4. Все получают уведомления об изменениях через Telegram

## User Stories

### Игрок
- Как игрок, я хочу видеть список предстоящих игр и тренировок, чтобы планировать своё время
- Как игрок, я хочу записаться на игру одной кнопкой, чтобы не писать в чат
- Как игрок, я хочу отменить запись, если планы изменились
- Как игрок, я хочу видеть, попал ли я в состав на игру

### Тренер
- Как тренер, я хочу создать событие (игра/тренировка), указав дату, время и место
- Как тренер, я хочу видеть, кто записался на событие
- Как тренер, я хочу сформировать состав: кто играет, кто в запасе
- Как тренер, я хочу отменить или изменить событие

### Администратор команды
- Как админ, я хочу создать команду и получить код приглашения
- Как админ, я хочу добавлять/удалять тренеров

## Основные сценарии

### Сценарий 1: Игрок записывается на игру

1. Игрок открывает Mini App через бота в Telegram
2. Видит список предстоящих событий своей команды
3. Нажимает на событие → видит детали (дата, время, место, кто записался)
4. Нажимает "Записаться" (или "Под вопросом" / "Не смогу")
5. Его статус отображается в списке записавшихся

### Сценарий 2: Тренер создаёт игру

1. Тренер открывает Mini App
2. Нажимает "Создать событие"
3. Выбирает тип: Игра / Тренировка
4. Указывает: дату, время, место, лимит игроков (опционально)
5. Событие появляется в списке команды
6. (Опционально) Telegram бот отправляет уведомление в чат команды

### Сценарий 3: Тренер формирует состав

1. Тренер открывает событие
2. Видит список записавшихся (статус: иду / под вопросом / не смогу)
3. Нажимает "Сформировать состав"
4. Перетаскивает игроков в категории: Основа / Запас / Не играет
5. Сохраняет состав
6. Игроки видят свой статус в приложении

### Сценарий 4: Новый игрок присоединяется к команде

1. Игрок получает ссылку-приглашение или код команды
2. Открывает Mini App
3. Вводит код или переходит по ссылке
4. Автоматически добавляется в команду как игрок
5. Видит события команды

## Сущности данных

### User (Пользователь)
- telegram_id — уникальный ID в Telegram
- name — имя из Telegram или кастомное
- Может быть в нескольких командах с разными ролями

### Team (Команда)
- name — название команды
- invite_code — код для присоединения

### TeamMember (Членство в команде)
- user + team
- role: PLAYER | COACH | ADMIN

### Event (Событие)
- team — к какой команде относится
- type: GAME | TRAINING
- datetime — когда
- location — где
- max_players — лимит (опционально)
- status: OPEN | CLOSED | CANCELLED
- created_by — кто создал

### Registration (Запись на событие)
- user + event
- status: GOING | MAYBE | NOT_GOING
- registered_at — когда записался

### Lineup (Состав)
- event + user
- position: PLAYING | RESERVE | BENCH

## Ограничения и допущения

### Что делаем в MVP
- Один пользователь может быть в нескольких командах
- Базовые роли: игрок, тренер
- Создание/редактирование/отмена событий
- Запись на события с тремя статусами
- Формирование состава тренером

### Что НЕ делаем в MVP
- Статистика игроков (голы, передачи)
- Повторяющиеся события (каждую неделю)
- Платежи и взносы
- Чат внутри приложения
- Push-уведомления (только через Telegram бота)

### Допущения
- У всех пользователей есть Telegram
- Команда уже общается в Telegram чате
- Достаточно одного тренера для формирования состава

## Риски

| Риск | Вероятность | Влияние | Митигация |
|------|-------------|---------|-----------|
| Telegram изменит API Mini Apps | Низкая | Высокое | Следить за обновлениями, использовать официальный SDK |
| Пользователи не будут открывать Mini App | Средняя | Высокое | Удобные кнопки в боте, уведомления |
| Конфликты при формировании состава | Низкая | Среднее | Только тренер может менять состав |

## Метрики успеха

- Команда из 20 человек успешно записывается на игру через приложение
- Время от создания события до формирования состава < 24 часов
- 80% записей происходит через приложение, а не в чате
- Тренер тратит < 5 минут на формирование состава

## Открытые вопросы

- [ ] Нужно ли подтверждение записи (например, за день до игры)?
- [ ] Как обрабатывать ситуацию, когда записалось больше людей, чем нужно?
- [ ] Показывать ли историю прошедших событий?
- [ ] Нужна ли роль "капитан" отдельно от тренера?

## Связанные документы

- План: `docs/plan/T-001.md`
- Задачи: `docs/tasklist/T-001.md`
